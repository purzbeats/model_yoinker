<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Model Scraper</title>
  <link rel="icon" href="favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="style.css">
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
</head>
<body>
  <div id="app">
    <!-- API Key Prompt Modal -->
    <div v-if="showApiKeyPrompt" class="modal-overlay" @click.self="dismissApiKeyPrompt">
      <div class="modal">
        <h2>Welcome to Model Scraper</h2>
        <p>To fetch models from CivitAI, you'll need an API key.</p>

        <form class="modal-form" @submit.prevent="saveAndDismissPrompt">
          <label for="prompt-civitai-key">CivitAI API Key</label>
          <div class="input-with-toggle">
            <input
              :type="settings.showCivitaiKey ? 'text' : 'password'"
              id="prompt-civitai-key"
              v-model="settings.civitaiApiKey"
              placeholder="Enter your CivitAI API key"
              class="text-input"
              autocomplete="off"
            >
            <button @click="settings.showCivitaiKey = !settings.showCivitaiKey" class="toggle-visibility" type="button">
              {{ settings.showCivitaiKey ? 'Hide' : 'Show' }}
            </button>
          </div>
          <p class="settings-hint">
            Get your API key from <a href="https://civitai.com/user/account" target="_blank">civitai.com/user/account</a>
          </p>
        </form>

        <div class="modal-actions">
          <button @click="saveAndDismissPrompt" class="btn-primary" :disabled="!settings.civitaiApiKey">Save & Continue</button>
          <button @click="dismissApiKeyPrompt" class="btn-secondary">Skip for now</button>
        </div>
      </div>
    </div>

    <header>
      <h1>Model Scraper</h1>
      <nav class="tabs">
        <button :class="{ active: activeTab === 'civitai' }" @click="activeTab = 'civitai'">CivitAI</button>
        <button :class="{ active: activeTab === 'huggingface' }" @click="activeTab = 'huggingface'">HuggingFace</button>
        <button :class="{ active: activeTab === 'single' }" @click="activeTab = 'single'">Single Model</button>
        <button :class="{ active: activeTab === 'mymodels' }" @click="activeTab = 'mymodels'">My Models</button>
        <button :class="{ active: activeTab === 'settings' }" @click="activeTab = 'settings'" class="settings-tab">Settings</button>
      </nav>
    </header>

    <main>
      <!-- CivitAI Tab -->
      <div v-show="activeTab === 'civitai'">
        <!-- Filter Bar -->
        <section class="filters">
          <div class="filter-group">
            <label>Sort By</label>
            <select v-model="civitai.filters.sort">
              <option value="Most Downloaded">Most Downloaded</option>
              <option value="Highest Rated">Highest Rated</option>
              <option value="Newest">Newest</option>
            </select>
          </div>

          <div class="filter-group">
            <label>Time Period</label>
            <select v-model="civitai.filters.period">
              <option value="AllTime">All Time</option>
              <option value="Year">Year</option>
              <option value="Month">Month</option>
              <option value="Week">Week</option>
              <option value="Day">Day</option>
            </select>
          </div>

          <div class="filter-group">
            <label>Model Types</label>
            <select v-model="civitai.filters.types">
              <option value="Checkpoint,LORA">Checkpoints + LoRAs</option>
              <option value="Checkpoint">Checkpoints Only</option>
              <option value="LORA">LoRAs Only</option>
            </select>
          </div>

          <div class="filter-group">
            <label>Architecture</label>
            <select v-model="civitai.filters.baseModels">
              <option value="">All Architectures</option>
              <optgroup label="Flux">
                <option value="Flux.1 D">Flux.1 Dev</option>
                <option value="Flux.2 D">Flux.2 Dev</option>
              </optgroup>
              <optgroup label="SDXL">
                <option value="SDXL 1.0">SDXL 1.0</option>
                <option value="SDXL 0.9">SDXL 0.9</option>
                <option value="SDXL Lightning">SDXL Lightning</option>
                <option value="SDXL Hyper">SDXL Hyper</option>
                <option value="SDXL 1.0 LCM">SDXL 1.0 LCM</option>
                <option value="Pony">Pony</option>
              </optgroup>
              <optgroup label="Illustrious">
                <option value="Illustrious">Illustrious</option>
                <option value="NoobAI">NoobAI</option>
              </optgroup>
              <optgroup label="SD 1.x / 2.x">
                <option value="SD 1.5">SD 1.5</option>
                <option value="SD 1.5 LCM">SD 1.5 LCM</option>
                <option value="SD 1.5 Hyper">SD 1.5 Hyper</option>
                <option value="SD 2.1">SD 2.1</option>
                <option value="SD 2.1 768">SD 2.1 768</option>
              </optgroup>
              <optgroup label="Video">
                <option value="Wan Video 14B t2v">Wan Video 14B</option>
                <option value="Wan Video 2.2 T2V-A14B">Wan Video 2.2</option>
              </optgroup>
              <optgroup label="Other">
                <option value="Qwen">Qwen</option>
                <option value="Qwen Image Edit 2509">Qwen Image Edit 2509</option>
                <option value="ZImageTurbo">ZImageTurbo</option>
                <option value="HiDream">HiDream</option>
                <option value="Other">Other</option>
              </optgroup>
            </select>
          </div>

          <div class="filter-group">
            <label>Max Results</label>
            <select v-model="civitai.filters.maxItems">
              <option value="50">50</option>
              <option value="100">100</option>
              <option value="200">200</option>
              <option value="500">500</option>
            </select>
          </div>

          <div class="filter-group checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" v-model="civitai.filters.excludeNsfw">
              <span>Exclude NSFW</span>
            </label>
          </div>

          <div class="filter-group checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" v-model="civitai.filters.excludeEarlyAccess">
              <span>Exclude Early Access</span>
            </label>
          </div>

          <button @click="fetchCivitAI" :disabled="civitai.loading" class="btn-primary">
            {{ civitai.loading ? 'Fetching...' : 'Fetch Models' }}
          </button>
        </section>

        <!-- Status -->
        <div v-if="civitai.error" class="error">{{ civitai.error }}</div>
        <div v-if="civitai.loading" class="loading">
          <div class="spinner"></div>
          <span>Fetching models from CivitAI...</span>
        </div>

        <!-- Results -->
        <section v-if="civitai.models.length > 0" class="results">
          <div class="results-header">
            <h2>Results ({{ civitai.models.length }} models)</h2>
            <div class="export-buttons">
              <button @click="selectAllCivitAI" class="btn-secondary">
                {{ civitaiAllSelected ? 'Deselect All' : 'Select All' }}
              </button>
              <button @click="exportCivitAI('json')" :disabled="civitai.selectedIds.length === 0" class="btn-secondary">
                Export JSON ({{ civitai.selectedIds.length }})
              </button>
              <button @click="exportCivitAI('csv')" :disabled="civitai.selectedIds.length === 0" class="btn-secondary">
                Export CSV ({{ civitai.selectedIds.length }})
              </button>
            </div>
          </div>

          <table class="models-table">
            <thead>
              <tr>
                <th class="col-select">
                  <input type="checkbox" :checked="civitaiAllSelected" @change="selectAllCivitAI">
                </th>
                <th class="col-thumb">Image</th>
                <th class="col-name sortable" @click="sortCivitAI('name')">
                  Name <span class="sort-icon">{{ getCivitAISortIcon('name') }}</span>
                </th>
                <th class="col-type sortable" @click="sortCivitAI('type')">
                  Type <span class="sort-icon">{{ getCivitAISortIcon('type') }}</span>
                </th>
                <th class="col-creator sortable" @click="sortCivitAI('creator')">
                  Creator <span class="sort-icon">{{ getCivitAISortIcon('creator') }}</span>
                </th>
                <th class="col-downloads sortable" @click="sortCivitAI('downloads')">
                  Downloads <span class="sort-icon">{{ getCivitAISortIcon('downloads') }}</span>
                </th>
                <th class="col-rating sortable" @click="sortCivitAI('rating')">
                  Rating <span class="sort-icon">{{ getCivitAISortIcon('rating') }}</span>
                </th>
                <th class="col-arch sortable" @click="sortCivitAI('baseModel')">
                  Arch <span class="sort-icon">{{ getCivitAISortIcon('baseModel') }}</span>
                </th>
                <th class="col-tags">Tags</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="model in civitaiSortedModels" :key="model.id" :class="{ selected: civitai.selectedIds.includes(model.id) }">
                <td>
                  <input type="checkbox" :value="model.id" v-model="civitai.selectedIds">
                </td>
                <td class="col-thumb">
                  <img
                    v-if="getCivitAIThumbnail(model)"
                    :src="getCivitAIThumbnail(model)"
                    :alt="model.name"
                    loading="lazy"
                  >
                  <div v-else class="no-thumb">No image</div>
                </td>
                <td class="col-name">
                  <a :href="'https://civitai.com/models/' + model.id" target="_blank">
                    {{ model.name }}
                  </a>
                  <span v-if="model.nsfw" class="nsfw-badge">NSFW</span>
                </td>
                <td class="col-type">
                  <span class="type-badge" :class="model.type.toLowerCase()">{{ model.type }}</span>
                </td>
                <td class="col-creator">{{ model.creator?.username || 'Unknown' }}</td>
                <td class="col-downloads">{{ formatNumber(model.stats?.downloadCount || 0) }}</td>
                <td class="col-rating">
                  <span class="rating">{{ formatRating(model.stats?.rating) }}</span>
                  <span class="rating-count">({{ model.stats?.ratingCount || 0 }})</span>
                </td>
                <td class="col-arch">
                  <span class="arch-badge">{{ getCivitAIBaseModel(model) }}</span>
                </td>
                <td class="col-tags">
                  <span v-for="tag in (model.tags || []).slice(0, 3)" :key="tag" class="tag">{{ tag }}</span>
                  <span v-if="(model.tags || []).length > 3" class="tag more">+{{ model.tags.length - 3 }}</span>
                </td>
              </tr>
            </tbody>
          </table>
        </section>

        <section v-else-if="!civitai.loading" class="empty-state">
          <p>No models loaded. Click "Fetch Models" to get started.</p>
        </section>
      </div>

      <!-- HuggingFace Tab -->
      <div v-show="activeTab === 'huggingface'">
        <!-- Filter Bar -->
        <section class="filters">
          <div class="filter-group">
            <label>Search</label>
            <input type="text" v-model="huggingface.filters.search" placeholder="e.g. flux lora" class="text-input">
          </div>

          <div class="filter-group">
            <label>Tags (comma-separated)</label>
            <input type="text" v-model="huggingface.filters.filterTags" placeholder="e.g. lora,diffusers" class="text-input">
          </div>

          <div class="filter-group">
            <label>Author</label>
            <input type="text" v-model="huggingface.filters.author" placeholder="e.g. black-forest-labs" class="text-input">
          </div>

          <div class="filter-group">
            <label>Architecture</label>
            <select v-model="huggingface.filters.architecture">
              <option value="">All Architectures</option>
              <optgroup label="Flux">
                <option value="flux.1-dev">Flux.1 Dev</option>
                <option value="flux.1-kontext">Flux.1 Kontext</option>
                <option value="flux.1-schnell">Flux.1 Schnell</option>
                <option value="flux.2">Flux.2</option>
              </optgroup>
              <optgroup label="Qwen">
                <option value="qwen-image-edit-2509">Qwen Image Edit 2509</option>
                <option value="qwen-image-edit">Qwen Image Edit</option>
                <option value="qwen-image">Qwen Image</option>
              </optgroup>
              <optgroup label="Video">
                <option value="wan">Wan Video</option>
                <option value="cogvideo">CogVideoX</option>
                <option value="hunyuan">HunyuanVideo</option>
              </optgroup>
              <optgroup label="Other">
                <option value="z-image-turbo">Z-Image Turbo</option>
                <option value="hidream">HiDream</option>
                <option value="sdxl">SDXL</option>
                <option value="illustrious">Illustrious</option>
                <option value="noobai">NoobAI</option>
                <option value="pony">Pony</option>
                <option value="sd15">SD 1.5</option>
              </optgroup>
            </select>
          </div>

          <div class="filter-group">
            <label>Sort By</label>
            <select v-model="huggingface.filters.sort">
              <option value="downloads">Downloads</option>
              <option value="likes">Likes</option>
              <option value="lastModified">Last Modified</option>
              <option value="createdAt">Created At</option>
            </select>
          </div>

          <div class="filter-group">
            <label>Max Results</label>
            <select v-model="huggingface.filters.limit">
              <option value="25">25</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
          </div>

          <div class="filter-group checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" v-model="huggingface.filters.fetchFiles">
              <span>Fetch File Details</span>
            </label>
          </div>

          <button @click="fetchHuggingFace" :disabled="huggingface.loading" class="btn-primary">
            {{ huggingface.loading ? 'Fetching...' : 'Fetch Models' }}
          </button>
        </section>

        <!-- Status -->
        <div v-if="huggingface.error" class="error">{{ huggingface.error }}</div>
        <div v-if="huggingface.loading" class="loading">
          <div class="spinner"></div>
          <span>Fetching models from HuggingFace...</span>
        </div>

        <!-- Results -->
        <section v-if="huggingface.models.length > 0" class="results">
          <div class="results-header">
            <h2>Results ({{ huggingface.models.length }} models)</h2>
            <div class="export-buttons">
              <button @click="selectAllHuggingFace" class="btn-secondary">
                {{ huggingfaceAllSelected ? 'Deselect All' : 'Select All' }}
              </button>
              <button @click="exportHuggingFace('json')" :disabled="huggingface.selectedIds.length === 0" class="btn-secondary">
                Export JSON ({{ huggingface.selectedIds.length }})
              </button>
              <button @click="exportHuggingFace('csv')" :disabled="huggingface.selectedIds.length === 0" class="btn-secondary">
                Export CSV ({{ huggingface.selectedIds.length }})
              </button>
            </div>
          </div>

          <table class="models-table">
            <thead>
              <tr>
                <th class="col-select">
                  <input type="checkbox" :checked="huggingfaceAllSelected" @change="selectAllHuggingFace">
                </th>
                <th class="col-name sortable" @click="sortHuggingFace('id')">
                  ID <span class="sort-icon">{{ getHuggingFaceSortIcon('id') }}</span>
                </th>
                <th class="col-creator sortable" @click="sortHuggingFace('author')">
                  Author <span class="sort-icon">{{ getHuggingFaceSortIcon('author') }}</span>
                </th>
                <th class="col-downloads sortable" @click="sortHuggingFace('downloads')">
                  Downloads <span class="sort-icon">{{ getHuggingFaceSortIcon('downloads') }}</span>
                </th>
                <th class="col-likes sortable" @click="sortHuggingFace('likes')">
                  Likes <span class="sort-icon">{{ getHuggingFaceSortIcon('likes') }}</span>
                </th>
                <th class="col-arch sortable" @click="sortHuggingFace('arch')">
                  Arch <span class="sort-icon">{{ getHuggingFaceSortIcon('arch') }}</span>
                </th>
                <th class="col-files">Files</th>
                <th class="col-tags">Tags</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="model in huggingfaceSortedModels" :key="model.id" :class="{ selected: huggingface.selectedIds.includes(model.id) }">
                <td>
                  <input type="checkbox" :value="model.id" v-model="huggingface.selectedIds">
                </td>
                <td class="col-name">
                  <a :href="'https://huggingface.co/' + model.id" target="_blank">
                    {{ model.id }}
                  </a>
                </td>
                <td class="col-creator">{{ model.author }}</td>
                <td class="col-downloads">{{ formatNumber(model.downloads) }}</td>
                <td class="col-likes">{{ formatNumber(model.likes) }}</td>
                <td class="col-arch">
                  <span class="arch-badge">{{ detectHFArchitecture(model) }}</span>
                </td>
                <td class="col-files">
                  <span v-if="model.siblings">{{ countSafetensors(model) }} .safetensors</span>
                  <span v-else class="text-muted">-</span>
                </td>
                <td class="col-tags">
                  <span v-for="tag in getDisplayTags(model).slice(0, 3)" :key="tag" class="tag">{{ tag }}</span>
                  <span v-if="getDisplayTags(model).length > 3" class="tag more">+{{ getDisplayTags(model).length - 3 }}</span>
                </td>
              </tr>
            </tbody>
          </table>
        </section>

        <section v-else-if="!huggingface.loading" class="empty-state">
          <p>No models loaded. Enter search terms or filters and click "Fetch Models".</p>
        </section>
      </div>

      <!-- Single Model Tab -->
      <div v-show="activeTab === 'single'">
        <section class="filters">
          <div class="filter-group" style="flex: 1;">
            <label>CivitAI URL or Model ID</label>
            <input
              type="text"
              v-model="single.url"
              placeholder="https://civitai.com/models/123456 or just 123456"
              class="text-input"
              @keyup.enter="fetchSingleModel"
            >
          </div>

          <button @click="fetchSingleModel" :disabled="single.loading || !single.url" class="btn-primary">
            {{ single.loading ? 'Fetching...' : 'Fetch Model' }}
          </button>
        </section>

        <!-- Status -->
        <div v-if="single.error" class="error">{{ single.error }}</div>
        <div v-if="single.loading" class="loading">
          <div class="spinner"></div>
          <span>Fetching model from CivitAI...</span>
        </div>

        <!-- Model Card -->
        <section v-if="single.model" class="model-card">
          <div class="model-card-header">
            <div class="model-card-image">
              <img
                v-if="getSingleModelThumbnail()"
                :src="getSingleModelThumbnail()"
                :alt="single.model.name"
              >
              <div v-else class="no-thumb">No image</div>
            </div>
            <div class="model-card-info">
              <h2>
                <a :href="'https://civitai.com/models/' + single.model.id" target="_blank">
                  {{ single.model.name }}
                </a>
                <span v-if="single.model.nsfw" class="nsfw-badge">NSFW</span>
              </h2>
              <p class="model-meta">
                <span class="type-badge" :class="single.model.type.toLowerCase()">{{ single.model.type }}</span>
                <span>by <strong>{{ single.model.creator?.username || 'Unknown' }}</strong></span>
              </p>
              <div class="model-stats">
                <span><strong>{{ formatNumber(single.model.stats?.downloadCount || 0) }}</strong> downloads</span>
                <span><strong>{{ formatNumber(single.model.stats?.favoriteCount || 0) }}</strong> favorites</span>
                <span><strong>{{ formatRating(single.model.stats?.rating) }}</strong> rating ({{ single.model.stats?.ratingCount || 0 }})</span>
              </div>
              <div class="model-tags" v-if="single.model.tags && single.model.tags.length">
                <span v-for="tag in single.model.tags.slice(0, 10)" :key="tag" class="tag">{{ tag }}</span>
                <span v-if="single.model.tags.length > 10" class="tag more">+{{ single.model.tags.length - 10 }}</span>
              </div>
            </div>
          </div>

          <!-- Versions -->
          <div class="model-versions" v-if="single.model.modelVersions && single.model.modelVersions.length">
            <h3>Versions ({{ single.model.modelVersions.length }})</h3>
            <div class="versions-list">
              <div
                v-for="version in single.model.modelVersions"
                :key="version.id"
                class="version-item"
                :class="{ selected: single.selectedVersionId === version.id }"
                @click="single.selectedVersionId = version.id"
              >
                <div class="version-header">
                  <strong>{{ version.name }}</strong>
                  <span class="arch-badge">{{ version.baseModel }}</span>
                </div>
                <div class="version-meta">
                  <span>Created: {{ formatDate(version.createdAt) }}</span>
                  <span v-if="version.trainedWords && version.trainedWords.length">
                    Triggers: {{ version.trainedWords.join(', ') }}
                  </span>
                </div>
                <div class="version-files" v-if="version.files && version.files.length">
                  <div v-for="file in version.files" :key="file.id" class="file-item">
                    <span class="file-name">{{ file.name }}</span>
                    <span class="file-size">{{ formatFileSize(file.sizeKB) }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Export Selected Version -->
          <div class="model-export" v-if="single.selectedVersionId">
            <h3>Export Selected Version</h3>
            <pre class="export-preview">{{ getSingleModelExportJSON() }}</pre>
            <button @click="copySingleModelExport" class="btn-secondary">Copy to Clipboard</button>
          </div>
        </section>

        <section v-else-if="!single.loading" class="empty-state">
          <p>Paste a CivitAI model URL or ID above to view its details.</p>
        </section>
      </div>

      <!-- My Models Tab -->
      <div v-show="activeTab === 'mymodels'">
        <!-- File Upload Section -->
        <section class="filters">
          <div class="filter-group" style="flex: 1;">
            <label>Load JSON File</label>
            <div class="file-upload-wrapper">
              <input
                type="file"
                id="json-file-input"
                accept=".json"
                @change="handleFileUpload"
                class="file-input"
              >
              <label for="json-file-input" class="file-upload-label">
                <span v-if="!mymodels.fileName">Choose supported_models.json file...</span>
                <span v-else>{{ mymodels.fileName }}</span>
              </label>
            </div>
          </div>

          <div class="filter-group">
            <label>Filter by Directory</label>
            <select v-model="mymodels.filters.directory">
              <option value="">All Directories</option>
              <option v-for="dir in mymodelsDirectories" :key="dir" :value="dir">{{ dir }}</option>
            </select>
          </div>

          <div class="filter-group">
            <label>Search</label>
            <input type="text" v-model="mymodels.filters.search" placeholder="Search model names..." class="text-input">
          </div>

          <button @click="clearMyModels" :disabled="mymodels.models.length === 0" class="btn-secondary">
            Clear
          </button>
        </section>

        <!-- Status -->
        <div v-if="mymodels.error" class="error">{{ mymodels.error }}</div>

        <!-- Results -->
        <section v-if="mymodels.models.length > 0" class="results">
          <div class="results-header">
            <h2>Models ({{ mymodelsFilteredModels.length }} of {{ mymodels.models.length }})</h2>
            <div class="export-buttons">
              <button @click="selectAllMyModels" class="btn-secondary">
                {{ mymodelsAllSelected ? 'Deselect All' : 'Select All' }}
              </button>
              <button @click="openBulkEditModal" :disabled="mymodels.selectedIndices.length === 0" class="btn-primary">
                Edit Selected ({{ mymodels.selectedIndices.length }})
              </button>
              <button @click="exportMyModels" :disabled="mymodels.models.length === 0" class="btn-secondary">
                Export JSON
              </button>
            </div>
          </div>

          <table class="models-table mymodels-table">
            <thead>
              <tr>
                <th class="col-select">
                  <input type="checkbox" :checked="mymodelsAllSelected" @change="selectAllMyModels">
                </th>
                <th class="col-thumb">Preview</th>
                <th class="col-name sortable" @click="sortMyModels('model_name')">
                  Model Name <span class="sort-icon">{{ getMyModelsSortIcon('model_name') }}</span>
                </th>
                <th class="col-directory sortable" @click="sortMyModels('directory')">
                  Directory <span class="sort-icon">{{ getMyModelsSortIcon('directory') }}</span>
                </th>
                <th class="col-url">URL</th>
                <th class="col-actions">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr
                v-for="(model, index) in mymodelsSortedModels"
                :key="model._index"
                :class="{ selected: mymodels.selectedIndices.includes(model._index) }"
              >
                <td>
                  <input type="checkbox" :value="model._index" v-model="mymodels.selectedIndices">
                </td>
                <td class="col-thumb">
                  <img
                    v-if="model.preview_url && !model.preview_url.includes('drive.google.com')"
                    :src="model.preview_url"
                    :alt="model.model_name"
                    loading="lazy"
                    @error="$event.target.style.display='none'"
                  >
                  <div v-else-if="model.preview_url" class="preview-link" :title="model.preview_url">
                    <a :href="model.preview_url" target="_blank" class="gdrive-link">GDrive</a>
                  </div>
                  <div v-else class="no-thumb">No preview</div>
                </td>
                <td class="col-name">
                  <span class="model-filename">{{ model.model_name }}</span>
                </td>
                <td class="col-directory">
                  <span class="directory-badge">{{ model.directory }}</span>
                </td>
                <td class="col-url">
                  <span v-if="model.url === 'SKIP'" class="url-skip">SKIP</span>
                  <a v-else :href="model.url" target="_blank" class="url-link" :title="model.url">
                    {{ truncateUrl(model.url) }}
                  </a>
                </td>
                <td class="col-actions">
                  <button @click="openEditModal(model._index)" class="btn-icon" title="Edit">
                    <span>Edit</span>
                  </button>
                  <button @click="deleteModel(model._index)" class="btn-icon btn-danger" title="Delete">
                    <span>Del</span>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </section>

        <section v-else class="empty-state">
          <p>No models loaded. Upload a supported_models.json file to get started.</p>
          <p class="empty-state-hint">You can export models from CivitAI or HuggingFace tabs, then edit them here.</p>
        </section>

        <!-- Edit Modal -->
        <div v-if="mymodels.showEditModal" class="modal-overlay" @click.self="closeEditModal">
          <div class="modal edit-modal">
            <h2>{{ mymodels.bulkEdit ? 'Bulk Edit' : 'Edit Model' }}</h2>
            <p v-if="mymodels.bulkEdit" class="modal-subtitle">
              Editing {{ mymodels.selectedIndices.length }} models. Leave fields empty to keep existing values.
            </p>

            <form class="modal-form" @submit.prevent="saveEdit">
              <div class="settings-group" v-if="!mymodels.bulkEdit">
                <label for="edit-model-name">Model Name</label>
                <input
                  type="text"
                  id="edit-model-name"
                  v-model="mymodels.editForm.model_name"
                  class="text-input"
                  placeholder="filename.safetensors"
                >
              </div>

              <div class="settings-group">
                <label for="edit-directory">Directory</label>
                <select id="edit-directory" v-model="mymodels.editForm.directory" class="text-input">
                  <option value="">{{ mymodels.bulkEdit ? '-- Keep existing --' : 'Select directory' }}</option>
                  <option value="checkpoints">checkpoints</option>
                  <option value="loras">loras</option>
                  <option value="embeddings">embeddings</option>
                  <option value="vae">vae</option>
                  <option value="controlnet">controlnet</option>
                  <option value="clip">clip</option>
                  <option value="clip_vision">clip_vision</option>
                  <option value="diffusion_models">diffusion_models</option>
                  <option value="text_encoders">text_encoders</option>
                  <option value="unet">unet</option>
                  <option value="upscale_models">upscale_models</option>
                  <option value="hypernetworks">hypernetworks</option>
                  <option value="style_models">style_models</option>
                </select>
              </div>

              <div class="settings-group" v-if="!mymodels.bulkEdit">
                <label for="edit-url">URL</label>
                <input
                  type="text"
                  id="edit-url"
                  v-model="mymodels.editForm.url"
                  class="text-input"
                  placeholder="https://... or SKIP"
                >
              </div>

              <div class="settings-group">
                <label for="edit-preview-url">Preview URL</label>
                <input
                  type="text"
                  id="edit-preview-url"
                  v-model="mymodels.editForm.preview_url"
                  class="text-input"
                  :placeholder="mymodels.bulkEdit ? '-- Keep existing or enter new URL --' : 'https://...'"
                >
                <p class="settings-hint" v-if="mymodels.bulkEdit">
                  Tip: Use placeholders like <code>{directory}</code> or <code>{model_name}</code>
                </p>
              </div>

              <div class="modal-actions">
                <button type="submit" class="btn-primary">
                  {{ mymodels.bulkEdit ? 'Apply to Selected' : 'Save' }}
                </button>
                <button type="button" @click="closeEditModal" class="btn-secondary">Cancel</button>
                <button
                  v-if="mymodels.bulkEdit"
                  type="button"
                  @click="deleteSelectedModels"
                  class="btn-danger-full"
                >
                  Delete Selected ({{ mymodels.selectedIndices.length }})
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Settings Tab -->
      <div v-show="activeTab === 'settings'">
        <section class="settings-panel">
          <h2>API Settings</h2>
          <p class="settings-description">
            Your API keys are stored locally in your browser and are sent directly to the respective APIs.
            They are never stored on our servers.
          </p>

          <form class="settings-form" @submit.prevent="saveSettings">
            <div class="settings-group">
              <label for="civitai-key">CivitAI API Key</label>
              <div class="input-with-toggle">
                <input
                  :type="settings.showCivitaiKey ? 'text' : 'password'"
                  id="civitai-key"
                  v-model="settings.civitaiApiKey"
                  placeholder="Enter your CivitAI API key"
                  class="text-input"
                  autocomplete="off"
                >
                <button @click="settings.showCivitaiKey = !settings.showCivitaiKey" class="toggle-visibility" type="button">
                  {{ settings.showCivitaiKey ? 'Hide' : 'Show' }}
                </button>
              </div>
              <p class="settings-hint">
                Get your API key from <a href="https://civitai.com/user/account" target="_blank">civitai.com/user/account</a>
              </p>
            </div>

            <div class="settings-group">
              <label for="huggingface-token">HuggingFace Token</label>
              <div class="input-with-toggle">
                <input
                  :type="settings.showHuggingfaceToken ? 'text' : 'password'"
                  id="huggingface-token"
                  v-model="settings.huggingfaceToken"
                  placeholder="Enter your HuggingFace token (optional)"
                  class="text-input"
                  autocomplete="off"
                >
                <button @click="settings.showHuggingfaceToken = !settings.showHuggingfaceToken" class="toggle-visibility" type="button">
                  {{ settings.showHuggingfaceToken ? 'Hide' : 'Show' }}
                </button>
              </div>
              <p class="settings-hint">
                Get your token from <a href="https://huggingface.co/settings/tokens" target="_blank">huggingface.co/settings/tokens</a>
              </p>
            </div>

            <div class="settings-actions">
              <button type="submit" class="btn-primary">Save Settings</button>
              <button type="button" @click="clearSettings" class="btn-secondary">Clear All</button>
              <span v-if="settings.saveMessage" class="save-message" :class="{ success: settings.saveSuccess }">
                {{ settings.saveMessage }}
              </span>
            </div>
          </form>
        </section>
      </div>
    </main>
  </div>

  <script src="main.js"></script>
</body>
</html>
